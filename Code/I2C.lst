MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Warning[205]: Found directive in column 1. (LIST)
                      00001 LIST p=16F648A  ;tell assembler what chip we are using
Warning[205]: Found directive in column 1. (include)
                      00002 include "P16F648A.inc"  ;include the defaults for the chip
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F648A processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2011 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
Warning[205]: Found directive in column 1. (endm)
Warning[205]: Found directive in column 1. (endm)
                      00416         LIST
Warning[205]: Found directive in column 1. (errorlevel)
                      00003 errorlevel 2
                      00004 ERRORLEVEL -224 ; suppress annoying message because of tris
                      00005 ERRORLEVEL -302 ; suppress message because of page change
                      00006 
                      00007 
                      00008 
                      00009 #define SCL     RA0             ; bus clock line
                      00010 #define SDA     RA1             ; bus data line
                      00011 #define I2C_TRIS TRISA
                      00012 #define I2C_PORT PORTA
                      00013 
  0000                00014 Global Read_DS1307
  0000                00015 Global Initialize_RTC
  0000                00016 Global Write_DS1307
  0000                00017 Global I2C_Init
  0000                00018 Global SEC
  0000                00019 Global MIN
  0000                00020 Global HOUR
  0000                00021 Global I2C_Start
  0000                00022 Global I2C_Stop
  0000                00023 Global I2C_Write
  0000                00024 Global Check_RTC
                      00025 
                      00026 Bank0 UDATA
0000                  00027 I2C_Data res 1
                      00028 
0001                  00029 HOUR res 1
0002                  00030 MIN res 1
0003                  00031 SEC res 1
                      00032 
                      00033 
0004                  00034 Counter res 1
0005                  00035 I2Cflags res 1
0006                  00036 OutputByte res 1
                      00037 
                      00038 PROG1 code
                      00039 
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00040 
                      00041 
                      00042 ;DS1307 Write Address= 0xD0
                      00043 ;DS1307 Read Address= 0xD1
                      00044 ; ------------------------------------ 
                      00045 ; Initialize DS1307
                      00046 ; Sets time to 05:59:55
                      00047 ; and SQW/OUT to pulse on 1 Hz by seting the Control Register (addr 07)
                      00048 ; ------------------------------------ 
0000                  00049 Initialize_RTC
0000   2???           00050         Call I2C_Start
0001   30D0           00051         movlw 0xD0
0002   2???           00052         Call I2C_Write
0003   3000           00053         movlw 0x0
0004   2???           00054         Call I2C_Write
0005   3055           00055         movlw 0x55
0006   2???           00056         Call I2C_Write
0007   3059           00057         movlw 0x59
0008   2???           00058         Call I2C_Write
0009   3005           00059         movlw 0x05 
000A   2???           00060         Call I2C_Write
                      00061 
000B   2???           00062         Call I2C_Stop
                      00063 
000C   2???           00064         Call I2C_Start
000D   30D0           00065         movlw 0xD0
000E   2???           00066         Call I2C_Write
000F   3007           00067         movlw 0x7
0010   2???           00068         Call I2C_Write
0011   3010           00069         movlw 0x10
0012   2???           00070         Call I2C_Write
0013   2???           00071         Call I2C_Stop
                      00072         ;bsf INTCON,GIE
0014   0008           00073 return
                      00074 
                      00075 ; ------------------------------------ 
                      00076 ; Check if DS1307 is initialized
                      00077 ; If Bit 7 (CH bit) of SEC register (Address 00) is set, then the RTC internal oscillator is halted.
                      00078 ; if it is 0 then the clock is ticking.
                      00079 ; ------------------------------------ 
                      00080 
0015                  00081 Check_RTC
0015   01??           00082         CLRF I2C_Data
0016   2???           00083         Call I2C_Start
0017   30D0           00084         movlw 0xD0
0018   2???           00085         Call I2C_Write
0019   3000           00086         movlw 0x00
001A   2???           00087         Call I2C_Write
001B   2???           00088         Call I2C_Start
001C   30D1           00089         movlw 0xD1
001D   2???           00090         Call I2C_Write
001E   2???           00091         Call I2C_Read
001F   2???           00092         Call SendNACK
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0020   00??           00093         movwf I2Cflags
0021   2???           00094         Call I2C_Stop
0022   1F80           00095         btfss I2Cflags,7
0023   3400           00096         retlw 0x00
0024   3401           00097         retlw 0x01
                      00098 
0025                  00099 Write_DS1307
                      00100         ;bcf INTCON,GIE
0025   2???           00101         Call I2C_Start
0026   30D0           00102         movlw 0xD0
0027   2???           00103         Call I2C_Write
                      00104         ;sec
0028   3000           00105         movlw 0x0
0029   2???           00106         Call I2C_Write
002A   08??           00107         movf SEC,W
002B   2???           00108         Call I2C_Write
002C   08??           00109         movf MIN,W
002D   2???           00110         Call I2C_Write
002E   08??           00111         movf HOUR,W
002F   2???           00112         Call I2C_Write
0030   2???           00113         Call I2C_Stop
                      00114         ;bsf INTCON,GIE
0031   0008           00115 return
                      00116 
0032                  00117 Read_DS1307
                      00118         ;bcf INTCON,GIE
0032   01??           00119         CLRF I2C_Data
0033   2???           00120         Call I2C_Start
0034   30D0           00121         movlw 0xD0
0035   2???           00122         Call I2C_Write
0036   3000           00123         movlw 0x00
0037   2???           00124         Call I2C_Write
0038   2???           00125         Call I2C_Start
0039   30D1           00126         movlw 0xD1
003A   2???           00127         Call I2C_Write
003B   2???           00128         Call I2C_Read
003C   2???           00129         Call SendACK
003D   397F           00130         andlw b'01111111'
003E   00??           00131         movwf SEC
003F   2???           00132         Call I2C_Read
0040   2???           00133         Call SendACK
0041   397F           00134         andlw b'01111111'
0042   00??           00135         movwf MIN
0043   2???           00136         Call I2C_Read
0044   2???           00137         Call SendNACK
0045   393F           00138         andlw b'00111111'
0046   00??           00139         movwf HOUR
0047   2???           00140         Call I2C_Stop
0048   0008           00141 return
                      00142 
0049                  00143 I2C_Init
0049   2???           00144         call HIGH_SDA
004A   2???           00145         call HIGH_SCL
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

004B   0008           00146 return
                      00147 
                      00148 
004C                  00149 I2C_Start
004C   2???           00150         call HIGH_SCL
004D   2???           00151         call HIGH_SDA
004E   2???           00152         call LOW_SDA            ; bring SDA low while SCL is high
004F   2???           00153         call LOW_SCL
0050   0008           00154 return
                      00155 
0051                  00156 I2C_Stop
0051   2???           00157         call LOW_SCL
0052   2???           00158         call LOW_SDA
0053   2???           00159         call HIGH_SCL
0054   2???           00160         call HIGH_SDA           ; bring SDA high while SCL is high
0055   0008           00161 return
                      00162 
                      00163 ; ------------------------------------ 
                      00164 ; I2C Read
                      00165 ; W holds the data after reading is complete
                      00166 ; SDA should hold the DATA ans SCL should send the clock pulse
                      00167 ; Data can only been sent when SCL is low and kept stable when SCL is high
                      00168 ; ------------------------------------ 
0056                  00169 I2C_Read
0056   2???           00170         call HIGH_SDA ; make sda an input (while sSCL is low)
0057   01??           00171         clrf I2C_Data
0058   3008           00172         movlw 0x08
0059   00??           00173         movwf Counter
005A                  00174 ReadLoop
005A   2???           00175         call HIGH_SCL
005B   2???           00176         goto $+1
005C   2???           00177         goto $+1
005D   1C85           00178         btfss I2C_PORT,SDA
005E   2???           00179         Goto BitZero
005F   2???           00180         Goto BitOne
0060                  00181 BitZero
0060   1003           00182         bcf STATUS,C
0061   0D??           00183         rlf I2C_Data,F
0062   2???           00184         Goto Cont
0063                  00185 BitOne
0063   1403           00186         bsf STATUS,C
0064   0D??           00187         rlf I2C_Data,F
0065   2???           00188         goto Cont
0066                  00189 Cont
0066   2???           00190         call LOW_SCL
0067   2???           00191         goto $+1
0068   2???           00192         goto $+1
0069   0B??           00193         decfsz Counter,F
006A   2???           00194 goto ReadLoop
006B   08??           00195         movf I2C_Data,W
006C   0008           00196 return
                      00197 
006D                  00198 SendACK
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

006D   2???           00199         call    LOW_SDA
006E   2???           00200         call    Clock_Pulse
                      00201 
006F   0008           00202 return
                      00203 
0070                  00204 SendNACK
0070   2???           00205         call    HIGH_SDA
0071   2???           00206         call    Clock_Pulse
0072   0008           00207 return
                      00208 
                      00209 
                      00210 ; ------------------------------------ 
                      00211 ; I2C Write (MSB -> LSB)
                      00212 ; W should hold the byte to write
                      00213 ; SDA should hold the DATA ans SCL should send the clock pulse
                      00214 ; Data can only been sent when SCL is low and kept stable when SCL is high
                      00215 ; ------------------------------------ 
0073                  00216 I2C_Write
0073   00??           00217         movwf   OutputByte
0074   3008           00218         movlw   0x08
0075   00??           00219         movwf   Counter
0076   2???           00220         CALL    LOW_SCL
0077                  00221 Out_Bit:
0077   1003           00222         bcf     STATUS,         C       ; clear carry
0078   0D??           00223         rlf     OutputByte, f   ; left shift, most sig bit is now in carry
0079   1C03           00224         btfss   STATUS,         C       ; if one, send a one
007A   2???           00225         goto    Out_Zero
007B   2???           00226         goto    Out_One
                      00227 
007C                  00228 Out_Zero:
007C   2???           00229         call    LOW_SDA                 ; SDA at zero
007D   2???           00230         call    Clock_Pulse             ;Clock_Pulse
007E   2???           00231         goto    Out_Cont
007F                  00232 Out_One:
007F   2???           00233         call    HIGH_SDA                ; SDA at logic one
0080   2???           00234         call    Clock_Pulse
0081   2???           00235         goto    $+1
0082                  00236 Out_Cont:
0082   0B??           00237         decfsz  Counter,                F       ; decrement index
0083   2???           00238         goto    Out_Bit
                      00239 
                      00240 ;Check for Acknowledgent
                      00241         ;call   LOW_SCL
0084   2???           00242         call    HIGH_SDA                ; 9th clock pulse to test for ACK
0085   2???           00243         call    HIGH_SCL                ; Practically, SDA can never go High if the the slave-receiver h
                            as received
0086   01??           00244         clrf    Counter                 ; data properly and Acknowledges the reception by holding it low
                            .
0087                  00245 WaitForACK      
0087   0A??           00246         incf    Counter, f              ; increase timeout counter each time ACK is not received
0088   1903           00247         btfsc   STATUS, Z
0089   2???           00248         goto    No_ACK_Received
008A   1885           00249         btfsc   I2C_PORT,       SDA     ; If receiver Keeps SDA low then it means that
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

008B   2???           00250         goto    WaitForACK              ; he acknowledges the transfer. 
008C   1000           00251         bcf     I2Cflags, 0                     ;
008D   2???           00252         call    LOW_SCL
008E   0008           00253 return
008F                  00254 No_ACK_Received
008F   1400           00255         bsf     I2Cflags, 0             ; set flag bit
0090   2???           00256         call    LOW_SCL
0091   0008           00257 return  
                      00258 
                      00259 
                      00260 ; ------------------------------------ 
                      00261 ; Make SDA High
                      00262 ; Since SDA is pulled up, to become high should be configured as input (having high impedance thus float
                            s)
                      00263 ; ------------------------------------ 
0092                  00264 HIGH_SDA                
0092   1683 1303      00265         Banksel I2C_TRIS
0094   1485           00266         bsf     I2C_TRIS,SDA    ; make SDA pin an input
0095   1283 1303      00267         Banksel 0
                      00268 
0097   0008           00269 return
                      00270 
                      00271 ; ------------------------------------ 
                      00272 ; Make SDA Low
                      00273 ; Since SDA is pulled up, to become Low the pin 
                      00274 ; should be configured as output with state=0
                      00275 ; ------------------------------------ 
0098                  00276 LOW_SDA
0098   1085           00277         bcf     I2C_PORT,SDA    ; send 0
0099   1683 1303      00278         banksel I2C_TRIS                ; bank 1
009B   1085           00279         bcf     I2C_TRIS,SDA    ; make SDA pin an output
009C   1283 1303      00280         Banksel 0                               ; back to bank 0
                      00281 
009E   0008           00282 return
                      00283 
009F                  00284 HIGH_SCL
009F   1683 1303      00285         Banksel I2C_TRIS
00A1   1405           00286         bsf     I2C_TRIS,SCL    ; make SDA pin an input
00A2   1283 1303      00287         Banksel 0
                      00288 
00A4   0008           00289 return
                      00290 
00A5                  00291 LOW_SCL
00A5   1005           00292         bcf     I2C_PORT,SCL    ; send 0
00A6   1683 1303      00293         banksel I2C_TRIS                ; bank 1
00A8   1005           00294         bcf     I2C_TRIS,SCL    ; make SDL pin an output
00A9   1283 1303      00295         Banksel 0                               ; back to bank 0
                      00296 
00AB   0008           00297 return
                      00298 
00AC                  00299 Clock_Pulse                                     ; SCL momentarily to logic one
                      00300         ;call   HIGH_SCL
00AC   1683 1303      00301         Banksel I2C_TRIS
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00AE   1405           00302         bsf     I2C_TRIS,SCL    ; make SDA pin an input
00AF   1283 1303      00303         Banksel 0
00B1   2???           00304         goto $+1
00B2   2???           00305         goto $+1
                      00306         ;goto $+1
                      00307         ;goto $+1
                      00308         ;call   LOW_SCL
00B3   1005           00309         bcf     I2C_PORT,SCL    ; send 0
00B4   1683 1303      00310         banksel I2C_TRIS                ; bank 1
00B6   1005           00311         bcf     I2C_TRIS,SCL    ; make SDL pin an output
00B7   1283 1303      00312         Banksel 0                               ; back to bank 0
00B9   2???           00313         goto $+1
00BA   2???           00314         goto $+1
                      00315         ;goto $+1
                      00316         ;goto $+1
                      00317 
00BB   0008           00318 return  
                      00319 
                      00320 end
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  8


SYMBOL TABLE
  LABEL                             VALUE 

ADDEN                             00000003
ADEN                              00000003
BRGH                              00000002
Bank0                             00000000
BitOne                            00000063
BitZero                           00000060
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000001F
CMIE                              00000006
CMIF                              00000006
CREN                              00000004
CSRC                              00000007
Check_RTC                         00000015
Clock_Pulse                       000000AC
Cont                              00000066
Counter                           00000004
DATA_CP_OFF                       00003FFF
DATA_CP_ON                        00003EFF
DC                                00000001
Decimal                           00000001
DownEnter                         00000050
Drain                             00000000
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
Flood                             00000001
GIE                               00000007
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE  9


SYMBOL TABLE
  LABEL                             VALUE 

HIGH_SCL                          0000009F
HIGH_SDA                          00000092
HOUR                              00000001
I2C_Data                          00000000
I2C_Init                          00000049
I2C_PORT                          PORTA
I2C_Read                          00000056
I2C_Start                         0000004C
I2C_Stop                          00000051
I2C_TRIS                          TRISA
I2C_Write                         00000073
I2Cflags                          00000005
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
Idle                              000000FF
Initialize_RTC                    00000000
LCD_2Lines                        0000002C
LCD_4bit                          00000020
LCD_Blinc                         0000000D
LCD_Clear                         00000001
LCD_CursorHome                    00000002
LCD_DisOff                        00000008
LCD_DisOn                         0000000C
LCD_Line1                         00000080
LCD_Line2                         000000C0
LCD_Lines                         00000002
LCD_Underline                     0000000E
LOW_SCL                           000000A5
LOW_SDA                           00000098
MIN                               00000002
NOT_BO                            00000000
NOT_BOD                           00000000
NOT_BOR                           00000000
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
No                                00000000
No_ACK_Received                   0000008F
OERR                              00000001
OPTION_REG                        00000081
OSCF                              00000003
OnOff                             00000003
Out_Bit                           00000077
Out_Cont                          00000082
Out_One                           0000007F
Out_Zero                          0000007C
OutputByte                        00000006
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE 10


SYMBOL TABLE
  LABEL                             VALUE 

PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
ReadLoop                          0000005A
Read_DS1307                       00000032
SCL                               RA0
SDA                               RA1
SEC                               00000003
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
STATUS                            00000003
SYNC                              00000004
SendACK                           0000006D
SendNACK                          00000070
T0CS                              00000005
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE 11


SYMBOL TABLE
  LABEL                             VALUE 

T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRMT                              00000001
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE 12


SYMBOL TABLE
  LABEL                             VALUE 

UpEnter                           00000060
UpEsc                             000000A0
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009F
VREN                              00000007
VROE                              00000006
VRR                               00000005
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
WaitForACK                        00000087
Write_DS1307                      00000025
Yes                               00000001
YesNo                             00000002
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEVID1                           00002006
_ER_OSC_CLKOUT                    00003FFF
_ER_OSC_NOCLKOUT                  00003FFE
_EXTCLK_OSC                       00003FEF
_HS_OSC                           00003FEE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_INTOSC_OSC_CLKOUT                00003FFD
_INTOSC_OSC_NOCLKOUT              00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PROG1_005B                       0000005B
_PROG1_005C                       0000005C
_PROG1_0067                       00000067
_PROG1_0068                       00000068
_PROG1_0081                       00000081
_PROG1_00B1                       000000B1
_PROG1_00B2                       000000B2
_PROG1_00B9                       000000B9
_PROG1_00BA                       000000BA
MPASM  5.51                           I2C.ASM   4-5-2020  21:47:16         PAGE 13


SYMBOL TABLE
  LABEL                             VALUE 

_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC_CLKOUT                    00003FFF
_RC_OSC_NOCLKOUT                  00003FFE
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FED
__16F648A                         00000001
m_RestoreBank                     
m_SaveBank                        

Errors   :     0
Warnings :     5 reported,    31 suppressed
Messages :     0 reported,     6 suppressed

