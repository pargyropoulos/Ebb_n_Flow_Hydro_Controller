MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Warning[205]: Found directive in column 1. (include)
                      00001 include "P16F648A.inc"  ;include the defaults for the chip
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F648A processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2011 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
Warning[205]: Found directive in column 1. (endm)
Warning[205]: Found directive in column 1. (endm)
                      00416         LIST
Warning[205]: Found directive in column 1. (errorlevel)
                      00002 errorlevel 2
                      00003 
  0000                00004 Global ReadVarTable
  0000                00005 Global ReadExtMenuItem
  0000                00006 Global ReadCursorTbl
  0000                00007 Global ReadMenuTable
                      00008 
                      00009 ;From Main.asm
  0000                00010 Extern EEPROM_Data
  0000                00011 Extern EEPROM_Read
  0000                00012 Extern EEPROM_Address
  0000                00013 Extern EEPROM_DataType
  0000                00014 Extern EEPROM_Min
  0000                00015 Extern EEPROM_Max
  0000                00016 Extern VarTbl_PCLATH
  0000                00017 Extern VarTbl_PCL
  0000                00018 Extern ExtMenuItem
  0000                00019 Extern ExtMenuItem_Offset
  0000                00020 Extern ExtMenuItem_Segment
  0000                00021 Extern CursorPos
  0000                00022 Extern MenuItem
                      00023 
                      00024 ;From DataTables.asm
  0000                00025 Extern MenuItemTbl
                      00026 
                      00027 #Define VarTbl_EEPROM    VarTbl_Data+0
                      00028 #Define VarTbl_Datatype  VarTbl_Data+1
                      00029 #Define VarTbl_Min               VarTbl_Data+2
                      00030 #Define VarTbl_Max               VarTbl_Data+3
                      00031 
                      00032 #Define ExtMenu_VarNum                          ExtMenuItem+0
                      00033 #Define ExtMenu_VarOffset                       ExtMenuItem+1
                      00034 #Define ExtMenu_VarSegment                      ExtMenuItem+2
                      00035 #Define ExtMenu_TextOffset                      ExtMenuItem+3
                      00036 #Define ExtMenu_TextSegment             ExtMenuItem+4
                      00037 #Define ExtMenu_CursorTblOffset         ExtMenuItem+5
                      00038 #Define ExtMenu_CursorTblSegment        ExtMenuItem+6
                      00039 #Define ExtMenu_StateMachine            ExtMenuItem+7
                      00040 
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00041 
                      00042 
                      00043 
                      00044 Bank0 udata 
0000                  00045         VarTbl_Cnt Res 1
0001                  00046         VarTbl_Data  Res 0x04 ; holds the Variables' table
                      00047 
                      00048 Temp_Variables UDATA_OVR
0000                  00049         Counter Res 1
0001                  00050         tmp Res 1
0002                  00051         Menu_tmp Res 1
                      00052 
                      00053 PROG1 code
                      00054 ; ------------------------------------ 
                      00055 ; Read VarTBL table  
                      00056 ; on call W must hold the number of variables to read
                      00057 ; First, the Variable Table is read and then
                      00058 ; it is populated with the appropriate EEPROM data
                      00059 ; ------------------------------------ 
0000                  00060 ReadVarTable
0000   00??           00061         movwf VarTbl_Cnt
0001   01??           00062         clrf tmp
0002                  00063 VarTBLLoop
0002   2???           00064         Call VarTbl_Read ; one row at a time
                      00065 
0003   30??           00066         movlw EEPROM_Data; Set FSR to point 
0004   07??           00067         addwf tmp,W              ; on EEPROM_Data+tmp
0005   0084           00068         movwf FSR                ;
                      00069 
0006   08??           00070         movf VarTbl_EEPROM,W ; Load EEPROM address to W
0007   2???           00071         Call EEPROM_Read
0008   0080           00072         movwf INDF
                      00073 
0009   2???           00074         Call MoveToRam  
000A   0A??           00075         incf tmp 
000B   08??           00076         movf VarTbl_Cnt,W
000C   06??           00077         xorwf tmp,W
000D   1903           00078         BTFSC STATUS,Z
000E   2???           00079         GOTO $+2
000F   2???           00080         goto VarTBLLoop
0010   0008           00081 return
                      00082 
                      00083 ;Copies Data from VarTbl.* to EEPROM.* in Bank 1
0011                  00084 MoveToRam
0011   30??           00085         movlw EEPROM_Address
0012   07??           00086         addwf tmp,W
0013   0084           00087         movwf FSR
0014   08??           00088         movf VarTbl_EEPROM,W
0015   0080           00089         movwf INDF
                      00090 
0016   30??           00091         movlw EEPROM_DataType
0017   07??           00092         addwf tmp,W
0018   0084           00093         movwf FSR
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0019   08??           00094         movf VarTbl_Datatype,W
001A   0080           00095         movwf INDF
                      00096 
001B   30??           00097         movlw EEPROM_Min
001C   07??           00098         addwf tmp,W
001D   0084           00099         movwf FSR
001E   08??           00100         movf VarTbl_Min,W
001F   0080           00101         movwf INDF
                      00102 
0020   30??           00103         movlw EEPROM_Max
0021   07??           00104         addwf tmp,W
0022   0084           00105         movwf FSR
0023   08??           00106         movf VarTbl_Max,W
0024   0080           00107         movwf INDF
0025   0008           00108 return
                      00109 
                      00110 
                      00111 
                      00112 ; ------------------------------------ 
                      00113 ; Read Variables Table
                      00114 ; Called only from ReadVarTable routine
                      00115 ; Reads the Variables Table from flash memory to set Variables' Min,Max,Datatype,EEPROM Addr
                      00116 ; VarTbl_PCLATH and VarTbl_PCL should hold the address of the table
                      00117 ; Results are stored in VarTbl_Data
                      00118 ; ------------------------------------ 
0026                  00119 VarTbl_Read
0026   01??           00120         clrf Counter
0027   ????           00121         Bankisel VarTbl_Loop
0028   3004           00122         movlw 0x04 ;Structure of Variable Table is 4 bytes long
0029   00??           00123         movwf Counter
002A   30??           00124         movlw VarTbl_Data ; Hold data in VarTbl_Data
002B   0084           00125         movwf FSR
002C   30??           00126         movlw High VarTbl_Loop
                      00127 
002D                  00128 VarTbl_Loop     
002D   2???           00129         Call VarTBL
002E   ????           00130         Pagesel $
002F   ????           00131         bankisel VarTbl_Data
0030   0080           00132         movwf INDF
                      00133 
0031   0A??           00134         Incf VarTbl_PCL         ; If next byte changes memory page
0032   1903           00135         btfsc STATUS,Z          ; then increase PCLATH. 
0033   0A??           00136         incf VarTbl_PCLATH  ; Status.Z is set when VarTBL becomes 0x00 from 0xFF
0034   0A84           00137         incf FSR
0035   03??           00138         decf Counter
0036   1903           00139         btfsc STATUS,Z
0037   0008           00140         return
0038   2???           00141         goto VarTbl_Loop
0039                  00142 VarTBL
0039   08??           00143         movf VarTbl_PCLATH,W  ; get the segment 
003A   008A           00144         movwf PCLATH          ; set the segment
003B   08??           00145         movf VarTbl_PCL,W         ; get the offset
003C   0082           00146         movwf PCL
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

003D   0008           00147 return
                      00148 
                      00149 
                      00150 ; ------------------------------------ 
                      00151 ; Read Extended Menu Table
                      00152 ; ------------------------------------ 
003E                  00153 ReadExtMenuItem
003E   01??           00154         clrf Counter
003F   ????           00155         Bankisel ExtMenuItem
0040   3008           00156         movlw 0x08 ;Structure of ExtMenuItem Table is 8 bytes long
0041   00??           00157         movwf Counter
0042   30??           00158         movlw ExtMenuItem ; Hold data in ExtMenuItem
0043   0084           00159         movwf FSR
0044   30??           00160         movlw High ExtMenuItem_Loop
0045                  00161 ExtMenuItem_Loop
0045   2???           00162         Call ExtMenuItemTbl
0046   ????           00163         pagesel $
0047   0080           00164         movwf INDF
0048   0A??           00165         Incf ExtMenuItem_Offset  ; If next byte changes memory page
0049   1903           00166         btfsc STATUS,Z               ; then increase PCLATH. 
004A   0A??           00167         incf ExtMenuItem_Segment  ; Status.Z is set when VarTBL becomes 0x00 from 0xFF
004B   0A84           00168         incf FSR
004C   03??           00169         decf Counter
004D   1903           00170         btfsc STATUS,Z
004E   0008           00171         return
004F   2???           00172         goto ExtMenuItem_Loop
0050                  00173 ExtMenuItemTbl
0050   08??           00174         movf ExtMenuItem_Segment,W  ; get the segment 
0051   008A           00175         movwf PCLATH               ; set the segment
0052   08??           00176         movf ExtMenuItem_Offset,W   ; get the offset
0053   0082           00177         movwf PCL
0054   0008           00178 return
                      00179 
                      00180 ; ------------------------------------ 
                      00181 ; Read Cursor Table
                      00182 ; W should hold the offset of the CursorSet
                      00183 ; ------------------------------------ 
0055                  00184 ReadCursorTbl
0055   01??           00185         clrf Counter
0056                  00186 CursorLoop
0056   30??           00187         movlw CursorPos
0057   07??           00188         addwf Counter,W
0058   0084           00189         movwf FSR
0059   2???           00190         Call ReadCursorData
005A   ????           00191         Pagesel $
005B   0080           00192         movwf INDF
                      00193 
005C   0800           00194         movf INDF,W
005D   0A??           00195         incf Counter
005E   08??           00196         movf ExtMenu_VarNum,W
005F   06??           00197         xorwf Counter,W
0060   1903           00198         btfsc STATUS,Z
0061   2???           00199         Goto $+2
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0062   2???           00200         goto CursorLoop
0063   0008           00201 return
0064                  00202 ReadCursorData
0064   08??           00203         movf ExtMenu_CursorTblSegment,W
0065   008A           00204         movwf PCLATH
0066   08??           00205         movf ExtMenu_CursorTblOffset,W
0067   07??           00206         addwf Counter,W
0068   1803           00207         btfsc STATUS,C
0069   0A8A           00208         incf PCLATH
006A   0082           00209         movwf PCL
                      00210 
                      00211 ; ------------------------------------ 
                      00212 ; Read LCD Menu Table
                      00213 ; W = the menu item which corresponds to an 8 byte record on the MenuItemTbl, so 256/8=32 items in each 
                            memory block
                      00214 ; First we divide the menuitem by 32 to calculate PCLATH
                      00215 ; e.g. MenuItem=35 thus 35/32=1. So PCLATH will be increase by one memory block from the initial MenuIte
                            mTbl
                      00216 ; Then 35*8=280 and since we only use 1 byte to store data, then the new offset will be 24 (0001 1000).
                      00217 ; So new address = MenuItemTbl_PCLATH + 1 : MenuItemTbl_PCL + 24
                      00218 ; Max number of menus should be 0xff = 256. (because 256 x 8 = 2048 bytes = one memory page)
                      00219 ; ------------------------------------ 
006B                  00220 ReadMenuTable
006B   00??           00221         Movwf Menu_tmp  ;hold the number of the menu
006C   00??           00222         Movwf tmp
006D   03??           00223         decf Menu_tmp,F ; decrease it by one
006E   03??           00224         decf tmp
006F   1003           00225         BCF STATUS,C
0070   0C??           00226         rrf tmp         ; divide by 2
0071   1003           00227         BCF STATUS,C
0072   0C??           00228         rrf tmp         ; divide by 4
0073   1003           00229         BCF STATUS,C
0074   0C??           00230         rrf tmp         ; divide by 8
0075   1003           00231         BCF STATUS,C
0076   0C??           00232         rrf tmp         ; divide by 16
0077   1003           00233         BCF STATUS,C
0078   0C??           00234         rrf tmp         ; divide by 32 (5 right rotations)
0079   1003           00235         BCF STATUS,C
007A   0D??           00236         rlf Menu_tmp ; multiply by 8 to find the real offset (3 left rotations)
007B   1003           00237         BCF STATUS,C
007C   0D??           00238         rlf Menu_tmp
007D   1003           00239         BCF STATUS,C
007E   0D??           00240         rlf Menu_tmp
007F   ????           00241         Bankisel MenuItem 
0080   30??           00242         movlw MenuItem  ; addr of Menuitem
0081   0084           00243         movwf FSR               ; to FSR
0082   3008           00244         movlw 0x08              ; 8 bytes to RAM
0083   00??           00245         movwf Counter
0084                  00246 Mtbl_Loop
0084   2???           00247         Call ReadMenuItem
0085   0080           00248         movwf INDF ; indirrect RAM write!
0086   0A84           00249         incf FSR
0087   0A??           00250         incf Menu_tmp
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0088   ????           00251         Pagesel $ ; fix PCLATH
0089   0B??           00252         decfsz Counter
008A   2???           00253         goto Mtbl_Loop
008B   0008           00254 return
                      00255 
008C                  00256 ReadMenuItem
008C   30??           00257         Movlw High MenuItemTbl
008D   07??           00258         addwf tmp,W
008E   008A           00259         movwf PCLATH
008F   30??           00260         movlw Low MenuItemTbl
0090   07??           00261         addwf Menu_tmp,W
0091   1803           00262         btfsc STATUS,C
0092   0A8A           00263         incf PCLATH
0093   0082           00264         movwf PCL
                      00265 end
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  7


SYMBOL TABLE
  LABEL                             VALUE 

ADDEN                             00000003
ADEN                              00000003
BRGH                              00000002
Bank0                             00000000
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000001F
CMIE                              00000006
CMIF                              00000006
CREN                              00000004
CSRC                              00000007
Counter                           00000000
CursorLoop                        00000056
CursorPos                         00000000
DATA_CP_OFF                       00003FFF
DATA_CP_ON                        00003EFF
DC                                00000001
Decimal                           00000001
DownEnter                         00000050
Drain                             00000000
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
EEPROM_Address                    00000000
EEPROM_Data                       00000000
EEPROM_DataType                   00000000
EEPROM_Max                        00000000
EEPROM_Min                        00000000
EEPROM_Read                       00000000
ExtMenuItem                       00000000
ExtMenuItemTbl                    00000050
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  8


SYMBOL TABLE
  LABEL                             VALUE 

ExtMenuItem_Loop                  00000045
ExtMenuItem_Offset                00000000
ExtMenuItem_Segment               00000000
ExtMenu_CursorTblOffset           ExtMenuItem+5
ExtMenu_CursorTblSegment          ExtMenuItem+6
ExtMenu_StateMachine              ExtMenuItem+7
ExtMenu_TextOffset                ExtMenuItem+3
ExtMenu_TextSegment               ExtMenuItem+4
ExtMenu_VarNum                    ExtMenuItem+0
ExtMenu_VarOffset                 ExtMenuItem+1
ExtMenu_VarSegment                ExtMenuItem+2
F                                 00000001
FERR                              00000002
FSR                               00000004
Flood                             00000001
GIE                               00000007
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
Idle                              000000FF
LCD_2Lines                        0000002C
LCD_4bit                          00000020
LCD_Blinc                         0000000D
LCD_Clear                         00000001
LCD_CursorHome                    00000002
LCD_DisOff                        00000008
LCD_DisOn                         0000000C
LCD_Line1                         00000080
LCD_Line2                         000000C0
LCD_Lines                         00000002
LCD_Underline                     0000000E
MenuItem                          00000000
MenuItemTbl                       00000000
Menu_tmp                          00000002
MoveToRam                         00000011
Mtbl_Loop                         00000084
NOT_BO                            00000000
NOT_BOD                           00000000
NOT_BOR                           00000000
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
No                                00000000
OERR                              00000001
OPTION_REG                        00000081
OSCF                              00000003
OnOff                             00000003
PCL                               00000002
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE  9


SYMBOL TABLE
  LABEL                             VALUE 

PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
ReadCursorData                    00000064
ReadCursorTbl                     00000055
ReadExtMenuItem                   0000003E
ReadMenuItem                      0000008C
ReadMenuTable                     0000006B
ReadVarTable                      00000000
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
STATUS                            00000003
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE 10


SYMBOL TABLE
  LABEL                             VALUE 

T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRMT                              00000001
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UpEnter                           00000060
UpEsc                             000000A0
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE 11


SYMBOL TABLE
  LABEL                             VALUE 

VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009F
VREN                              00000007
VROE                              00000006
VRR                               00000005
VarTBL                            00000039
VarTBLLoop                        00000002
VarTbl_Cnt                        00000000
VarTbl_Data                       00000001
VarTbl_Datatype                   VarTbl_Data+1
VarTbl_EEPROM                     VarTbl_Data+0
VarTbl_Loop                       0000002D
VarTbl_Max                        VarTbl_Data+3
VarTbl_Min                        VarTbl_Data+2
VarTbl_PCL                        00000000
VarTbl_PCLATH                     00000000
VarTbl_Read                       00000026
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Yes                               00000001
YesNo                             00000002
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEVID1                           00002006
_ER_OSC_CLKOUT                    00003FFF
_ER_OSC_NOCLKOUT                  00003FFE
_EXTCLK_OSC                       00003FEF
_HS_OSC                           00003FEE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_INTOSC_OSC_CLKOUT                00003FFD
_INTOSC_OSC_NOCLKOUT              00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PROG1_000E                       0000000E
MPASM  5.51                    READTABLES.ASM   4-5-2020  21:47:14         PAGE 12


SYMBOL TABLE
  LABEL                             VALUE 

_PROG1_002E                       0000002E
_PROG1_0046                       00000046
_PROG1_005A                       0000005A
_PROG1_0061                       00000061
_PROG1_0088                       00000088
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC_CLKOUT                    00003FFF
_RC_OSC_NOCLKOUT                  00003FFE
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FED
__16F648A                         00000001
m_RestoreBank                     
m_SaveBank                        
tmp                               00000001

Errors   :     0
Warnings :     4 reported,    30 suppressed
Messages :     0 reported,    24 suppressed

